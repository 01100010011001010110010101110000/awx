version: '2'
services:
  # Primary Tower Development Container
  tower:
    image: gcr.io/ansible-tower-engineering/tower_devel:${TAG}
    hostname: tower
    environment:
      RABBITMQ_HOST: rabbitmq
      RABBITMQ_USER: guest
      RABBITMQ_PASS: guest
      RABBITMQ_VHOST: /
    ports:
      - "8080:8080"
      - "5555:5555"
      - "8050:8050"
      - "8051:8051"
    links:
      - postgres
      - memcached
      - rabbitmq
    #   - sync
    # volumes_from:
    #   - sync
    volumes:
      - "../:/tower_devel"
    privileged: true

  # Postgres Database Container
  postgres:
    image: postgres:9.4.1
  memcached:
    image: memcached:alpine
  rabbitmq:
    image: rabbitmq:3-management
    ports:
      - "15672:15672"

  nginx:
    image: gcr.io/ansible-tower-engineering/tower_nginx:${TAG}
    ports:
      - "8043:443"
      - "8013:80"
    links:
      - tower

  # Source Code Synchronization Container
  # sync:
  #     build:
  #         context: ./docker-compose
  #         dockerfile: Dockerfile-sync
  #     command: "lsyncd -delay 1 -nodaemon -rsync /src /tower_devel"
  #     volumes:
  #         - /tower_devel
  #         - "../:/src"
  #     working_dir: /src
  #     stdin_open: true
  #     tty: true
